---
toc: content
group: 
  title: 前端工程
  order: 1
order: 1
---

# 前端架构
## 概述
在项目立项后，为了保证项目的高可用性、可扩展性、可伸缩性、性能以及安全，我们需要对项目进行架构设计。任何架构设计的实施必须以项目的特征为根本出发点，否则毫无意义。比如：
- 一个国际化网站，我们需要加入多语言的支持。
- 一个移动优先的网站，我们需要引入响应式的设计。

另外需要注意：架构设计需平衡短期交付与长期维护成本，例如在快速迭代的创业项目中，可能优先选择开发效率高的方案（如Vue），而非过度设计。

## 前端工程与前端架构的关系
任何项目，不论量级大小，都会涉及开发、测试、发布和维护，这些流程通常属于工程领域。每个企业内部应该要有一个针对所有项目的标准工程化规划。而前端架构，除了依赖项目本身的复杂度外，业务的类型、场景、平台、用户群体等特征同样会影响到架构的设计。比如上面提到的国际化和移动优先场景。

架构设计通常也会对前端工程产生影响，所以我们需要在架构设计中，增加前端工程方案调整的步骤。可以称为前端工程服务步骤。

## 架构设计流程
通常的架构设计流程如下：
- 项目类型判断：整理项目的运行环境、业务特征，用户特征等内容。
- 架构模式选择（SPA/MPA/微前端/跨端等）：可以根据项目的类型，初步确定架构模式
- 技术栈选择：根据团队的技术栈及项目的复杂程度等，确定是使用哪个前端技术栈。（React/Vue/Angular）
- 核心架构设计：根据技术栈及业务特征，设计源码目录结构/状态管理/路由模块化/第三方依赖等内容。
- 细节架构设计：根据业务模块拆分确定源码目录规则、权限、特殊场景设计等细节。
- 工程方案完善：根据上面的技术架构设计，完善前端工程内容。
- 架构演进：在迭代中不断验证和完善架构设计。

## 架构设计细节
### 项目类型判断
每个项目的立项，总是有对应业务场景。我们应该从项目的场景出发，了解它解决的问题，如何解决，项目最终会运行在什么样的环境，项目的终端用户是谁，他们是怎么使用项目的。 了解好这些基础信息，我们才可能对架构进行设计。
比如一个销售管理系统，它的场景可能是：
- 企业希望管理销售人员的户外行为，确保销售人员到达终端门店，并完成盘点，上报货架商品情况、订单信息，退货信息等任务。
- 企业的相关部门根据上报的情况，立刻做出反应。
- 管理层希望汇总相应的数据，用于每日早会或企业决策。
- 企业办公使用钉钉或飞书，希望上报的数据可以直接和日常的办公系统对接。

从场景，我们可以得出该项目至少要有Web端和钉钉或飞书的扩展应用。到于是否需要独立的手机端或小程序等，需要再根据其他情况判断。比如：
- 企业希望客户可以自定义上报，则可能需要考虑小程序、独立的App或一个移动优先的商城。
- 企业有自己的App，希望该业务与App对接，可能需要混合应用开发或App增加相应的功能。

项目的终端用户可能有：
- 企业的销售人员
- 企业的售后人员
- 企业的管理层
- 终端门店客户

他们的使用方式可能是：
- 销售人员主要使用手机，到达门店后，做下定位确认，并在手机上上报相应的数据。
- 售后人员在公司办公，主要使用电脑，在Web端做相应的订单，退货等信息审核、打印等操作。
- 管理层：使用手机端和Web端都有可能，关注统计数据，或导出相应的数据，进行开会用。

可以通过相关者访谈，用户旅行地图等手段完善这些基础信息。
### 架构模式选择
从应用的角度来说，常见的选择有：
- SPA架构：一般用在中小型的，不需要SEO的应用上。
- 微前端架构：对于业务逻辑复杂的中大型应用，可以考虑使用微前端来拆分，避免形成巨石应用。
  - 还需明确子应用通信方案（如Custom Events或状态共享），并考虑沙箱隔离（qiankun）和样式冲突（CSS Modules/Shadow DOM）
- 跨端架构：应用如果涉及H5、手机App等，且设计和功能相同，则需要考虑跨端的选择。
- 多页应用架构：比如商城，企业网站等需要SEO的站点，
  - 对于此种场景，首先需要考虑是否使用前后端分离。
  - 如果前后端分离，可以考虑使用像Nextjs的服务端渲染这样，
  - 不分离使用express、koa、eggjs及nextjs等框架的全栈架构。。
- 混合应用架构：一般在App或小程序等需要嵌入H5时，选择该模式。
### 技术栈选择
现在的主要选择有两种，基于Vue和React来构建。当然也可以使用微前端之类的架构，做好隔离，两者全使用。
一般来说，项目业务复杂，对性能要求更高的，建议选择React及其生态。项目要求快速完成，团队上手容易的，使用Vue及其生态。
对于跨端，可以选择的有：
- React Native
- Flutter
- Uniapp
- Taro
Flutter适合高性能UI一致性场景，Taro适合微信生态，需权衡学习成本与跨端覆盖率。

另外，还需要考虑脚手架及语言扩展的问题，比如使用umi或nextjs的脚手架。语言扩展主要是js和css的扩展方案。
总之，在这一步，我们需要搭建好前端的技术框架。

### 核心架构设计
在这步，根据技术栈和项目的业务特征，确定以下方面的内容：
- 路由：基于哪个路由方案？是否需要转成配置？是否需要确定目录及文件规则以自动加载？路由的勾子函数需要做些什么？等
- 状态管理：基于哪个状态管理方案？哪些是全局数据？哪些是业务数据？数据流是什么样的？
- 第三方库：需要考虑一些通用的库，如数据处理、日期处理、图形报表处理、cookie处理等。
- 目录结构：一般按功能模块、页面组件、通用组件、hooks、utils、静态资源及service等来设计，也可以理解为模块化的设计结构。

### 细节架构设计
根据具体的业务场景来设计相应的架构，如：
- 移动优先：响应式设计
- 国际化：多语言设计
- 扩展性：插件架构
- 广播消息：发布和订阅架构
- 离线场景： PWA
- 实时且复杂的数据计算：WebAssembly
- 权限：从全局到页面按钮的权限控制设计
- 安全性：输入验证方案、内容安全策略、哪些内容需要加密，预防跨站攻击及敏感数据脱敏等。
### 前端工程完善
根据上面的架构设计，我们需要对前端工程的规范、构建、部署、监控和统计等方面进行重新完善，以更适应当前项目的情况。
具体的内容见：
性能优化设计
这里的性能主要考虑：
- 项目的启动速度
- 项目的构建速度：需要考虑分包和持久化缓存策略
- 代码拆分及懒加载
- 运行时的性能，如：
  - 大数量展示里，需要考虑虚拟化。
  - 图片懒加载
- 静态资源CDN加速
- 源文件压缩：代码压缩、开启gzip
### 架构演进
在项目迭代中，持续完善项目架构。可以通过记录具体的问题来进行优化设计，如：
- 表单的性能下降，可能是因为受控和非受控组件，及debounce等因素引起。
- 表单重复提交，可能是共享按钮的loading和disable的特性有问题。
- 打包体积变大：可能是因为引入了某个新的库，但是没有做懒加载。
- 样式互相影响：可能是微前端的样式隔离方案有问题。
## 总结
总之，前端架构设计需以项目特征为核心，围绕业务场景、用户需求和技术约束展开。从项目类型判断到技术选型（SPA/微前端/跨端），再到核心架构（路由、状态管理）与细节设计（国际化、权限），每一步都需平衡性能、扩展性与维护成本。工程化方案（构建、部署、监控）与持续演进同样关键。良好的架构应具备前瞻性，同时为迭代留出灵活空间，最终实现高效、稳定且安全的产品交付。


